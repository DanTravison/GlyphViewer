<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodel="clr-namespace:GlyphViewer.ViewModels"
             xmlns:views="clr-namespace:GlyphViewer.Views"
             xmlns:text="clr-namespace:GlyphViewer.Text"
             xmlns:controls="clr-namespace:GlyphViewer.Controls"
             x:Class="GlyphViewer.Views.FontFamiliesView"
             x:DataType="viewmodel:MainViewModel"
             x:Name="this">

    <ContentView.Resources>

        <Style TargetType="HorizontalStackLayout" x:Key="GroupHeaderStyle">
            <Setter Property="VisualStateManager.VisualStateGroups">
                <VisualStateGroupList>
                    <VisualStateGroup x:Name="CommonStates">
                        <VisualState x:Name="Normal" />
                        <VisualState x:Name="PointerOver">
                            <VisualState.Setters>
                                <Setter Property="BackgroundColor"
                                        Value="SkyBlue" />
                            </VisualState.Setters>
                        </VisualState>
                    </VisualStateGroup>
                </VisualStateGroupList>
            </Setter>
        </Style>

        <DataTemplate x:DataType="text:IFontFamilyGroup" x:Key="JumpListItemTemplate">
            <Label Text="{Binding Name}"
                   Style="{StaticResource JumpListItemStyle}"/>
        </DataTemplate>

        <DataTemplate x:DataType="text:IFontFamilyGroup" x:Key="GroupHeaderTemplate">
            <HorizontalStackLayout Style="{StaticResource GroupHeaderStyle}">
                <Label Text="{Binding Name}"
                           FontSize="18"
                           FontAttributes="Bold"
                           Margin="0"
                           TextColor="{AppThemeBinding Light={StaticResource PrimaryDarkText}, Dark=WhiteSmoke}"
                           />
                <HorizontalStackLayout.GestureRecognizers>
                    <!-- TODO: convert this to a command -->
                    <TapGestureRecognizer Tapped="OnPickGroup"/>
                </HorizontalStackLayout.GestureRecognizers>
            </HorizontalStackLayout>
        </DataTemplate>

        <DataTemplate x:DataType="x:String" x:Key="GroupItemTemplate">
            <Label Text="{Binding}"
                           Style="{StaticResource NameStyle}"
                           />
        </DataTemplate>

        <Style TargetType="CollectionView" x:Key="FontFamilyGroupStyle">
            <Setter Property="IsGrouped" Value="True"/>
            <Setter Property="SelectionMode" Value="Single"/>
            <Setter Property="GroupHeaderTemplate" Value="{StaticResource GroupHeaderTemplate}"/>
            <Setter Property="ItemTemplate" Value="{StaticResource GroupItemTemplate}"/>
        </Style>

    </ContentView.Resources>

    <!-- NOTE: Placing ContentView directly in a '*' row can cause
         the content to overflow the row. Use 'Auto,*' as a workaround.
    -->
    <Grid RowDefinitions="Auto, Auto, *">

        <CollectionView Grid.Row="0"
                        Style="{StaticResource FontFamilyGroupStyle}"
                        ItemsSource="{Binding FontFamilyGroups.Bookmarks, Mode=OneWay}"
                        SelectedItem="{Binding SelectedBookmark, Mode=TwoWay}"
                        Margin="0"
                        />

        <!-- NOTE: Placing Families and GroupPicker in the same row/column.
             Using JumpList.ZIndex to show/hide the picker.
        -->
        <controls:JumpList x:Name="GroupPicker" 
                           Grid.Row="21"
                           Grid.RowSpan="2"
                           ItemsSource="{Binding FontFamilyGroups, Mode=OneWay}"
                           SelectedItem="{Binding SelectedFamilyGroup, Mode=OneWayToSource}"
                           ItemTemplate="{StaticResource JumpListItemTemplate}"
                           />

        <CollectionView x:Name="Families"
                        Grid.Row="1"
                        Grid.RowSpan="2"
                        Style="{StaticResource FontFamilyGroupStyle}"
                        ItemsSource="{Binding FontFamilyGroups, Mode=OneWay}"
                        SelectedItem="{Binding Metrics.FontFamily, Mode=TwoWay}"
                        />
                    <!-- ISSUE: CollectionView.ScrollTo is not working
                        SelectionChanged="OnSelectionChanged"
                    -->
    </Grid>

</ContentView>
